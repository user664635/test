#network connecting
iwctl station device connect ssid

#format & mount
mkfs.fat -F 32 /dev/efi_system_partition
mkfs.xfs -f /dev/root_partition
mount /dev/root_partition /mnt
mount --mkdir /dev/efi_system_partition /mnt/boot

#config pacman
vim /etc/pacman.d/mirrorlist 
vim /etc/pacman.conf #ParallelDownloads

#install software
pacstrap -K /mnt base linux-{zen{,-headers},firmware} ntfs-3g grub efibootmgr networkmanager nvidia-{dkms,settings} fish vim noto-fonts-{cjk,emoji,extra} tmux xorg-{server,xinit} gnome-shell alacritty firefox fcitx5-{im,chinese-addons} code base-devel git clang mold rustup

genfstab -U /mnt >> /mnt/etc/fstab

#switch to new root
arch-chroot /mnt fish

#set fish as default shell
chsh -s /bin/fish

#set localtime
ln -sf /usr/share/zoneinfo/Region/City /etc/localtime

ln -s /bin/vim /bin/vi

#config
cd /etc

#set language
vi locale.gen #en_US.UTF-8 UTF-8
locale-gen 
vi locale.conf #LANG=en_US.UTF-8

#set hostname
vi hostname

#for nvidia settings
vi mkinitcpio.conf #HOOKS kms
mkinitcpio -P

#set passward
passwd

#config grub
grub-install --target=x86_64-efi --efi-directory=/boot --bootloader-id=GRUB
vi default/grub #timeout
grub-mkconfig -o /boot/grub/grub.cfg

#add user
visudo
useradd -mG wheel -s /bin/fish username
passwd username

#config pacman
vi pacman.conf #multilib paralleldownloads

#enable networkmanager
systemctl enable NetworkManager

#config user
su username
cd
vi .xinitrc
export XDG_SESSION_TYPE=x11
export GDK_BACKEND=x11
exec gnome-session

#install cargo
rustup toolchain install nightly
vi .cargo/config.toml
[target.x86_64-unknown-linux-gnu]
linker = "clang"
rustflags = ["-C", "link-arg=-fuse-ld=/usr/bin/mold"]

#install paru
cd /tmp
git clone https://aur.archlinux.org/paru.git
cd paru
makepkg -si

#install nekoray
paru -S nekoray sing-geo{site,ip}

#exit
umount -R /mnt
reboot

